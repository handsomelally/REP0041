USE [PowerBIModels]
GO
/****** Object:  StoredProcedure [dbo].[sp_REP0041_Param_SP_Brand]    Script Date: 22/01/2026 14:06:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


ALTER   PROCEDURE [dbo].[sp_REP0041_Param_SP_Brand]
    @BR_Filter nvarchar(max) = NULL  -- pass '3rd Party|PPG_PP/SC' for multi-select
AS
BEGIN
    SET NOCOUNT ON;

    WITH p AS (
        SELECT LTRIM(RTRIM(value)) AS v
        FROM STRING_SPLIT(@BR_Filter, '|')
        WHERE @BR_Filter IS NOT NULL
    )
    SELECT DISTINCT
        BR.Brand
    FROM [PPCGIVDWHSQL01\EXTERNALDATA,1434].ServiceNowControl.Reference.Brands BR
    WHERE
        BR.Brand IS NOT NULL
        AND (
            @BR_Filter IS NULL
            OR EXISTS (
                SELECT 1
                FROM p
                WHERE p.v = CASE
                    WHEN BR.Prefix = 'TP' THEN '3rd Party'
                    WHEN BR.Prefix IN ('CYP','BRS') THEN 'PPG_BRS/CY'
                    WHEN BR.Prefix IN ('PP','SC') THEN 'PPG_PP/SC'
                    WHEN BR.Brand  LIKE 'SIMS%' THEN 'PPG_SIMS'
                    WHEN BR.Prefix IN ('UNITE','CEDAR','LMC') THEN 'PPG_FHEL'
                    WHEN BR.Prefix = 'ADTV' THEN 'PPG_ADTV'
                    ELSE 'NEW BRAND'
                END
            )
        )
    ORDER BY BR.Brand;
END
